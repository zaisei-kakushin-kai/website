<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>減税計画シート</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas -->
    <script src="https://cdn.jsdelivr.net/npm/dom-to-image"></script>
    <style>
      @media print {
        .print-hidden {
          display: none !important;
        }
      }
      input[type="text"],
      input[type="number"] {
        background: transparent;
      }
    </style>
  </head>
  <body class="bg-white text-gray-900">
    <div class="max-w-5xl mx-auto md:p-10">
      <div id="form-area" class="p-6">
        <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-6">
          減税計画シート
        </h1>

        <!-- ここから画像化する範囲 -->
        <div class="space-y-5">
          <!-- 年度・県・市 -->
          <table class="w-full border border-black">
            <tbody>
              <tr class="divide-x divide-black">
                <th
                  class="w-24 bg-gray-100 border-r border-black p-2 text-left align-middle"
                >
                  年度
                </th>
                <td class="p-2">
                  <input
                    type="text"
                    name="year"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <th
                  class="w-24 bg-gray-100 border-x border-black p-2 text-left align-middle"
                >
                  県
                </th>
                <td class="p-2">
                  <input
                    type="text"
                    name="prefecture"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <th
                  class="w-24 bg-gray-100 border-x border-black p-2 text-left align-middle"
                >
                  市
                </th>
                <td class="p-2">
                  <input
                    type="text"
                    name="city"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
            </tbody>
          </table>

          <!-- 歳出総額 -->
          <table class="w-full border border-black">
            <tbody>
              <tr class="divide-x divide-black">
                <th class="bg-gray-100 p-2 w-40 text-left">歳出総額</th>
                <td class="p-2">
                  <div class="flex items-end gap-2">
                    <input
                      type="number"
                      inputmode="decimal"
                      name="total_expenditure"
                      class="w-full border-b border-black focus:outline-none"
                    />
                    <span>円</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- 市町村民税 -->
          <h2 class="text-xl font-bold">市町村民税</h2>
          <table class="w-full border border-black">
            <thead>
              <tr class="divide-x divide-black">
                <th class="bg-gray-100 p-2 text-left w-[28%]">項目</th>
                <th class="bg-gray-100 p-2 text-left w-[36%]">
                  収入済額（円）
                </th>
                <th class="bg-gray-100 p-2 text-left">超過課税分（円）</th>
              </tr>
            </thead>
            <tbody>
              <tr class="divide-x divide-black">
                <td class="p-2">個人均等割</td>
                <td class="p-2">
                  <input
                    type="number"
                    name="personal_fixed_income"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <td class="p-2">
                  <input
                    type="number"
                    name="personal_fixed_extra"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
              <tr class="divide-x divide-black">
                <td class="p-2">所得割</td>
                <td class="p-2">
                  <input
                    type="number"
                    name="income_income"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <td class="p-2">
                  <input
                    type="number"
                    name="income_extra"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
              <tr class="divide-x divide-black">
                <td class="p-2">法人均等割</td>
                <td class="p-2">
                  <input
                    type="number"
                    name="corporate_fixed_income"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <td class="p-2">
                  <input
                    type="number"
                    name="corporate_fixed_extra"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
              <tr class="divide-x divide-black">
                <td class="p-2">法人税割</td>
                <td class="p-2">
                  <input
                    type="number"
                    name="corporate_tax_income"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <td class="p-2">
                  <input
                    type="number"
                    name="corporate_tax_extra"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
            </tbody>
          </table>

          <!-- 目的税 -->
          <h2 class="text-xl font-bold">目的税</h2>
          <table class="w-full border border-black">
            <thead>
              <tr class="divide-x divide-black">
                <th class="bg-gray-100 p-2 text-left w-[28%]">税名</th>
                <th class="bg-gray-100 p-2 text-left w-[36%]">
                  収入済額（円）
                </th>
                <th class="bg-gray-100 p-2 text-left">超過課税分（円）</th>
              </tr>
            </thead>
            <tbody>
              <tr class="divide-x divide-black">
                <td class="p-2">
                  <input
                    type="text"
                    name="purpose_tax_name"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <td class="p-2">
                  <input
                    type="number"
                    name="purpose_tax_income"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
                <td class="p-2">
                  <input
                    type="number"
                    name="purpose_tax_extra"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
            </tbody>
          </table>

          <!-- 減税プラン -->
          <h2 class="text-xl font-bold">減税プラン</h2>
          <table class="w-full border border-black">
            <thead>
              <tr class="divide-x divide-black">
                <th class="bg-gray-100 p-2 text-left w-[28%]">プラン名</th>
                <th class="bg-gray-100 p-2 text-left">必要額（円）</th>
              </tr>
            </thead>
            <tbody>
              <tr class="divide-x divide-black">
                <td class="p-2">プラン1</td>
                <td class="p-2">
                  <input
                    type="number"
                    name="plan1_amount"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
              <tr class="divide-x divide-black">
                <td class="p-2">プラン2</td>
                <td class="p-2">
                  <input
                    type="number"
                    name="plan2_amount"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
            </tbody>
          </table>

          <!-- 削減額・比率 -->
          <table class="w-full border border-black">
            <tbody>
              <tr class="divide-x divide-black">
                <th class="bg-gray-100 p-2 text-left w-[48%]">
                  減税プランに必要な歳出削減額（円）
                </th>
                <td class="p-2">
                  <input
                    id="required_cut"
                    type="number"
                    name="reduction_amount"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
              <tr class="divide-x divide-black">
                <th class="bg-gray-100 p-2 text-left">
                  必要歳出削減額 ÷ 歳出総額 × 100（％）
                </th>
                <td class="p-2">
                  <input
                    id="cut_ratio"
                    type="number"
                    step="0.01"
                    name="reduction_rate"
                    class="w-full border-b border-black focus:outline-none"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- 画像化ここまで -->

      <!-- 操作ボタン -->
      <div
        class="mt-6 flex flex-wrap items-center justify-center gap-3 print-hidden"
      >
        <button
          type="submit"
          class="px-4 py-2 rounded-lg font-bold border border-gray-900 bg-gray-900 text-white"
        >
          送信
        </button>
        <button
          type="reset"
          class="px-4 py-2 rounded-lg font-bold border border-gray-900 bg-white"
        >
          リセット
        </button>
        <button
          id="exportBtn"
          type="button"
          class="px-4 py-2 rounded-lg font-bold border border-emerald-700 bg-emerald-600 text-white hover:bg-emerald-700"
        >
          PNGとして保存
        </button>
      </div>
    </div>
    <script>
      // PNGエクスポート
      document.getElementById("exportBtn").addEventListener("click", () => {
        const area = document.getElementById("form-area");
        domtoimage.toPng(area);
        const a = document.createElement("a");
        a.download = "減税計画シート.png";
        domtoimage
          .toPng(area, {
            bgcolor: "#ffffff",
          })
          .then((e) => {
            a.href = e;
            a.click();
          });
      });

      // オプション：比率を自動計算（入力が揃えば）
      const spend = document.querySelector('[name="total_expenditure"]');
      const cut = document.getElementById("required_cut");
      const ratio = document.getElementById("cut_ratio");
      function calc() {
        const s = parseFloat(spend?.value || "");
        const c = parseFloat(cut?.value || "");
        if (!isNaN(s) && s > 0 && !isNaN(c))
          ratio.value = ((c / s) * 100).toFixed(2);
      }
      spend?.addEventListener("input", calc);
      cut?.addEventListener("input", calc);
    </script>
  </body>
</html>
