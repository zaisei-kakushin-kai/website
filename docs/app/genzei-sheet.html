<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>減税計画シート（Tailwind＋PNG出力＋プレースホルダー）</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/dom-to-image"></script>
  <style>
    @media print { .print-hidden { display: none !important; } }
    input[type="text"], input[type="number"] { background: transparent; }
  </style>
</head>
<body class="bg-white text-gray-900">
  <div id="form-area">
    <div class="max-w-5xl mx-auto p-6 md:p-10">
      <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-6">#減税計画シート</h1>
      <div id="form-area" class="space-y-5">
        <!-- 年度・自治体名 -->
        <table class="w-full border border-black">
          <tr class="divide-x divide-black">
            <th class="bg-gray-100 p-2 w-32">年度</th>
            <td class="p-2">
              <input type="text" name="year" placeholder="例：2025" class="w-full border-b border-black focus:outline-none">
            </td>
          </tr>
          <tr class="divide-x divide-black">
            <th class="bg-gray-100 p-2 w-32">自治体名</th>
            <td class="p-2">
              <input type="text" name="municipality" placeholder="例：〇〇県〇〇市" class="w-full border-b border-black focus:outline-none">
            </td>
          </tr>
        </table>

        <!-- 歳出総額 -->
        <table class="w-full border border-black">
          <tr class="divide-x divide-black">
            <th class="bg-gray-100 p-2 w-32">歳出総額</th>
            <td class="p-2">
              <div class="flex items-end gap-2">
                <input type="number" name="total_expenditure" inputmode="decimal" class="w-full border-b border-black focus:outline-none">
                <span>円</span>
              </div>
            </td>
          </tr>
        </table>

        <!-- 市町村民税 -->
        <h2 class="text-xl font-bold">市町村民税</h2>
        <table class="w-full border border-black">
          <thead>
            <tr class="divide-x divide-black">
              <th class="bg-gray-100 p-2 text-left">項目</th>
              <th class="bg-gray-100 p-2 text-left">収入済額（円）</th>
              <th class="bg-gray-100 p-2 text-left">超過課税分（円）</th>
            </tr>
          </thead>
          <tbody>
            <tr class="divide-x divide-black">
              <td class="p-2">個人均等割</td>
              <td class="p-2"><input type="number" name="personal_fixed_income" class="w-full border-b border-black focus:outline-none"></td>
              <td class="p-2"><input type="number" name="personal_fixed_extra" class="w-full border-b border-black focus:outline-none"></td>
            </tr>
            <tr class="divide-x divide-black">
              <td class="p-2">所得割</td>
              <td class="p-2"><input type="number" name="income_income" class="w-full border-b border-black focus:outline-none"></td>
              <td class="p-2"><input type="number" name="income_extra" class="w-full border-b border-black focus:outline-none"></td>
            </tr>
            <tr class="divide-x divide-black">
              <td class="p-2">法人均等割</td>
              <td class="p-2"><input type="number" name="corporate_fixed_income" class="w-full border-b border-black focus:outline-none"></td>
              <td class="p-2"><input type="number" name="corporate_fixed_extra" class="w-full border-b border-black focus:outline-none"></td>
            </tr>
            <tr class="divide-x divide-black">
              <td class="p-2">法人税割</td>
              <td class="p-2"><input type="number" name="corporate_tax_income" class="w-full border-b border-black focus:outline-none"></td>
              <td class="p-2"><input type="number" name="corporate_tax_extra" class="w-full border-b border-black focus:outline-none"></td>
            </tr>
          </tbody>
        </table>

        <!-- 目的税 -->
        <h2 class="text-xl font-bold">目的税</h2>
        <table class="w-full border border-black">
          <thead>
            <tr class="divide-x divide-black">
              <th class="bg-gray-100 p-2 text-left">税名</th>
              <th class="bg-gray-100 p-2 text-left">収入済額（円）</th>
              <th class="bg-gray-100 p-2 text-left">超過課税分（円）</th>
            </tr>
          </thead>
          <tbody>
            <tr class="divide-x divide-black">
              <td class="p-2"><input type="text" name="purpose_tax_name" class="w-full border-b border-black focus:outline-none"></td>
              <td class="p-2"><input type="number" name="purpose_tax_income" class="w-full border-b border-black focus:outline-none"></td>
              <td class="p-2"><input type="number" name="purpose_tax_extra" class="w-full border-b border-black focus:outline-none"></td>
            </tr>
          </tbody>
        </table>

        <!-- 減税プラン -->
        <h2 class="text-xl font-bold">減税プラン</h2>
        <table class="w-full border border-black">
          <thead>
            <tr class="divide-x divide-black">
              <th class="bg-gray-100 p-2 text-left w-[28%]">プラン名</th>
              <th class="bg-gray-100 p-2 text-left">必要額（円）</th>
            </tr>
          </thead>
          <tbody>
            <tr class="divide-x divide-black">
              <td class="p-2">
                <input
                  type="text"
                  name="plan1_name"
                  placeholder="プラン名を入力"
                  class="w-full border-b border-black focus:outline-none font-semibold"
                >
              </td>
              <td class="p-2"><input type="number" name="plan1_amount" class="w-full border-b border-black focus:outline-none"></td>
            </tr>
            <tr class="divide-x divide-black">
              <td class="p-2">
                <input
                  type="text"
                  name="plan2_name"
                  placeholder="プラン名を入力"
                  class="w-full border-b border-black focus:outline-none font-semibold"
                >
              </td>
              <td class="p-2"><input type="number" name="plan2_amount" class="w-full border-b border-black focus:outline-none"></td>
            </tr>
          </tbody>
        </table>

        <!-- 削減額・比率 -->
        <table class="w-full border border-black">
          <tr class="divide-x divide-black">
            <th class="bg-gray-100 p-2 text-left">減税プランに必要な歳出削減額（円）</th>
            <td class="p-2"><input id="required_cut" type="number" name="reduction_amount" class="w-full border-b border-black focus:outline-none"></td>
          </tr>
          <tr class="divide-x divide-black">
            <th class="bg-gray-100 p-2 text-left">必要歳出削減額 ÷ 歳出総額 × 100（％）</th>
            <td class="p-2"><input id="cut_ratio" type="number" step="0.01" name="reduction_rate" class="w-full border-b border-black focus:outline-none"></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <!-- ボタン -->
  <div class="mb-6 flex flex-wrap items-center justify-center gap-3 print-hidden">
    <button id="exportBtn" type="button" class="px-4 py-2 rounded-lg font-bold border border-emerald-700 bg-emerald-600 text-white hover:bg-emerald-700">
      PNGとして保存
    </button>
  </div>
  <script>
    // PNG出力
    document.getElementById("exportBtn").addEventListener("click", () => {
        const area = document.getElementById("form-area");
        domtoimage.toPng(area);
        const a = document.createElement("a");
        a.download = "減税計画シート.png";
        domtoimage
          .toPng(area, {
            bgcolor: "#ffffff",
          })
          .then((e) => {
            a.href = e;
            a.click();
          });
    });

    // 自動比率計算
    const spend = document.querySelector('[name="total_expenditure"]');
    const cut = document.getElementById("required_cut");
    const ratio = document.getElementById("cut_ratio");

    function calc() {
      const s = parseFloat(spend?.value || "");
      const c = parseFloat(cut?.value || "");
      if (!isNaN(s) && s > 0 && !isNaN(c)) ratio.value = (c / s * 100).toFixed(2);
    }

    spend?.addEventListener("input", calc);
    cut?.addEventListener("input", calc);
  </script>
</body>
</html>
