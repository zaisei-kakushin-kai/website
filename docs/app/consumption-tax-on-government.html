<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>政府の負担する消費税概算アプリ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-white text-gray-900">
  <div class="max-w-4xl mx-auto p-6 md:p-8">
    <header class="flex items-center gap-3 my-3 mb-6">
      <div class="size-10 rounded-xl grid place-items-center bg-gray-300 text-gray-800" aria-hidden="true">📊</div>
      <div>
        <h1 class="m-0 text-2xl md:text-3xl font-extrabold text-gray-900">政府の負担する消費税 概算アプリ</h1>
      </div>
    </header>

    <section class="bg-gray-100 border border-gray-300 rounded-2xl p-5 shadow-sm" aria-labelledby="input-title">
      <h2 id="input-title" class="m-0 mb-3 text-lg font-semibold text-gray-800">入力</h2>
      <div class="grid gap-4 md:grid-cols-2" role="group" aria-label="パラメータ入力">
        <label class="flex flex-col gap-2 text-sm text-gray-700">歳出額総額（一般会計等）
          <div class="flex items-center gap-2 bg-white border border-gray-300 rounded-xl px-3 py-2 focus-within:ring-2 focus-within:ring-gray-400">
            <span class="opacity-70 text-gray-500">¥</span>
            <input id="total" inputmode="numeric" autocomplete="off" class="flex-1 bg-transparent outline-none text-gray-900" />
          </div>
        </label>
        <label class="flex flex-col gap-2 text-sm text-gray-700">人件費
          <div class="flex items-center gap-2 bg-white border border-gray-300 rounded-xl px-3 py-2 focus-within:ring-2 focus-within:ring-gray-400">
            <span class="opacity-70 text-gray-500">¥</span>
            <input id="personnel" inputmode="numeric" autocomplete="off" class="flex-1 bg-transparent outline-none text-gray-900" />
          </div>
        </label>
        <label class="flex flex-col gap-2 text-sm text-gray-700">公債費（元利償還）
          <div class="flex items-center gap-2 bg-white border border-gray-300 rounded-xl px-3 py-2 focus-within:ring-2 focus-within:ring-gray-400">
            <span class="opacity-70 text-gray-500">¥</span>
            <input id="debt" inputmode="numeric" autocomplete="off" class="flex-1 bg-transparent outline-none text-gray-900" />
          </div>
        </label>
      </div>
      <div class="flex flex-wrap gap-3 mt-4">
        <button id="demo" type="button" class="inline-flex items-center gap-2 rounded-xl bg-gray-800 text-white font-bold px-4 py-2 shadow hover:bg-gray-700 transition">サンプル値を入れる</button>
        <button id="clear" type="button" class="inline-flex items-center gap-2 rounded-xl bg-white text-gray-800 border border-gray-400 px-4 py-2 hover:bg-gray-100">クリア</button>
        <button id="generateImg" type="button" class="inline-flex items-center gap-2 rounded-xl bg-blue-500 text-white font-bold px-4 py-2 shadow hover:bg-blue-400 transition">画像を作る</button>
      </div>
    </section>

    <section class="mt-4 bg-gray-100 border border-gray-300 rounded-2xl p-5 shadow-sm" aria-labelledby="result-title">
      <h2 id="result-title" class="m-0 mb-3 text-lg font-semibold text-gray-800">結果</h2>

      <div id="msg" class="text-xs text-gray-500">数値を入力すると結果が表示されます。</div>

      <div class="grid gap-4 mt-4 md:grid-cols-1" aria-live="polite">
        <article class="bg-white border border-gray-300 rounded-2xl p-4">
          <div class="text-xs text-gray-500">歳出額総額</div>
          <div id="show-total" class="font-black text-xl md:text-2xl text-gray-900">—</div>
          <div id="kanji-total" class="text-sm text-gray-600">—</div>
        </article>
        <article class="bg-white border border-gray-300 rounded-2xl p-4">
          <div class="text-xs text-gray-500">人件費</div>
          <div id="show-personnel" class="font-black text-xl md:text-2xl text-gray-900">—</div>
          <div id="kanji-personnel" class="text-sm text-gray-600">—</div>
        </article>
        <article class="bg-white border border-gray-300 rounded-2xl p-4">
          <div class="text-xs text-gray-500">公債費</div>
          <div id="show-debt" class="font-black text-xl md:text-2xl text-gray-900">—</div>
          <div id="kanji-debt" class="text-sm text-gray-600">—</div>
        </article>
        <article class="bg-white border border-gray-300 rounded-2xl p-4">
          <div class="text-xs text-gray-500">政策的経費部分（歳出 − 人件費 − 公債費）</div>
          <div id="policy" class="font-black text-xl md:text-2xl text-gray-900">—</div>
          <div id="kanji-policy" class="text-sm text-gray-600">—</div>
        </article>
      </div>

      <div class="grid gap-4 mt-4">
        <article class="bg-white border border-gray-300 rounded-2xl p-4">
          <div class="text-xs text-gray-500">参考（よくある解釈）</div>
          <div class="text-xs text-gray-500">政策的経費 × (1 − 1/1.1) = 税相当額</div>
          <div id="alt" class="font-black text-xl md:text-2xl text-gray-900">—</div>
          <div id="kanji-alt" class="text-sm text-gray-600">—</div>
          <div class="text-xs text-gray-500">※ 上は参考計算です。ご提示の式とは異なります。</div>
        </article>
      </div>

      <section class="mt-3">
        <h3 class="text-sm font-semibold text-gray-800">式の確認</h3>
        <p class="text-xs text-gray-600">計算式：<span class="font-mono bg-gray-50 border border-gray-300 px-2 py-1 rounded-md text-gray-800">(歳出額総額 − (人件費 + 公債費)) − (1 − (1 / 1.1))</span></p>
      </section>
    </section>

    <footer class="mt-6 text-gray-500 text-xs">
      入力は端末上でのみ処理されます。小数点以下は切り捨てで円表示しています。
    </footer>
  </div>

  <script>   
    document.getElementById("exportBtn").addEventListener("click", () => {
      const area = document.getElementById("form-area");
      domtoimage.toPng(area);
      const a = document.createElement("a");
      a.download = "減税計画シート.png";
      domtoimage
        .toPng(area, {
          bgcolor: "#ffffff",
        })
        .then((e) => {
          a.href = e;
          a.click();
        });
    });

    const fmtJPY = (n)=> isFinite(n) ? new Intl.NumberFormat('ja-JP', { style:'currency', currency:'JPY', maximumFractionDigits:0}).format(Math.floor(n)) : '—';
    const parseNum = (v)=> Number(String(v).replace(/[\,\s]/g,'').trim()) || 0;

    const numToKanji = (num)=>{
      if (!isFinite(num) || num <= 0) return '—';
      const units = ['', '万', '億', '兆'];
      let result = '';
      let unitIndex = 0;
      while(num > 0 && unitIndex < units.length){
        const part = num % 10000;
        if(part > 0) result = part + units[unitIndex] + result;
        num = Math.floor(num / 10000);
        unitIndex++;
      }
      return result + '円くらい';
    };

    const $ = (id)=> document.getElementById(id);
    const els = { total: $('total'), personnel: $('personnel'), debt: $('debt'), showTotal: $('show-total'), showPersonnel: $('show-personnel'), showDebt: $('show-debt'), policy: $('policy'), alt: $('alt'), msg: $('msg'), kanjiTotal: $('kanji-total'), kanjiPersonnel: $('kanji-personnel'), kanjiDebt: $('kanji-debt'), kanjiPolicy: $('kanji-policy'), kanjiAlt: $('kanji-alt') };

    const K = 1 - 1/1.1;

    const update = ()=>{
      const total = parseNum(els.total.value);
      const personnel = parseNum(els.personnel.value);
      const debt = parseNum(els.debt.value);

      els.showTotal.textContent = isFinite(total) && total>0 ? fmtJPY(total) : '—';
      els.showPersonnel.textContent = isFinite(personnel) && personnel>0 ? fmtJPY(personnel) : '—';
      els.showDebt.textContent = isFinite(debt) && debt>0 ? fmtJPY(debt) : '—';

      els.kanjiTotal.textContent = numToKanji(total);
      els.kanjiPersonnel.textContent = numToKanji(personnel);
      els.kanjiDebt.textContent = numToKanji(debt);

      const policy = total - (personnel + debt);
      els.policy.textContent = isFinite(policy) ? fmtJPY(policy) : '—';
      els.kanjiPolicy.textContent = numToKanji(policy);

      const alt = policy * K;
      els.alt.textContent = isFinite(alt) ? fmtJPY(alt) : '—';
      els.kanjiAlt.textContent = numToKanji(alt);

      const allZero = [total, personnel, debt].every(v=>!v);
      els.msg.textContent = allZero ? '数値を入力すると結果が表示されます。' : '';

      [els.total, els.personnel, els.debt].forEach(input=>{
        const raw = input.value.replace(/,/g,'').trim();
        if(!raw) return;
        input.value = raw.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        input.setSelectionRange(input.value.length, input.value.length);
      });
    };

    ['input','change'].forEach(ev=>{
      ['total','personnel','debt'].forEach(id=>$(id).addEventListener(ev, update));
    });

    $('demo').addEventListener('click', ()=>{
      els.total.value = '120,000,000,000';
      els.personnel.value = '9,000,000,000';
      els.debt.value = '26,000,000,000';
      update();
    });

    $('clear').addEventListener('click', ()=>{
      ['total','personnel','debt'].forEach(id=>$(id).value='');
      update();
    });

    $('generateImg').addEventListener('click', ()=>{
      alert('画像を生成します（実装例：html2canvasなどを利用）');
    });

    update();
  </script>
</body>
</html>
